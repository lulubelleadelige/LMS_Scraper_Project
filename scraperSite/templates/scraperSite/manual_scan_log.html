{% extends 'scraperSite/base_template.html' %}
{% load static %}
{% block title %}Manual Scan Log-Moodle Scraper{% endblock %}


{% block content %}

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Your page styles -->
  <link href="{% static 'scraperSite/css/manual_scan_log.css' %}" rel="stylesheet">


  <div class="container-narrow">
    <a href="{% url 'manual_scan' %}" class="text-decoration-none">&larr; Back</a>

    <div class="text-center my-3">
      <h4 class="mb-1">Manual Scanned Log for {{ course_name }}</h4>
    </div>

    <!-- SUMMARY -->
    <div id="summaryRow" class="summary-row d-none">
      <div class="summary-card"><div>Benign</div><div class="num text-success" id="sumBenign">0</div></div>
      <div class="summary-card"><div>Suspicious</div><div class="num text-warning" id="sumSuspicious">0</div></div>
      <div class="summary-card"><div>Phishing</div><div class="num text-danger" id="sumPhish">0</div></div>
      <div class="summary-card"><div>Malware</div><div class="num text-danger" id="sumMalware">0</div></div>
      <div class="summary-card"><div>Adult</div><div class="num" style="color:#8e44ad" id="sumAdult">0</div></div>
    </div>

    <div class="card">
      <div class="card-body">
        <!-- Filters -->
        <div class="filters-grid">
          <div>
            <div class="filter-label mb-1">Label</div>
            <select id="labelFilter" class="form-select form-select-sm">
              <option value="all" selected>All Labels</option>
              <option value="benign">Benign</option>
              <option value="suspicious">Suspicious</option>
              <option value="phish">Phishing</option>
              <option value="malware">Malware</option>
              <option value="adult">Adult</option>
            </select>
          </div>
          <div>
            <div class="filter-label mb-1">Date From</div>
            <input id="dateFrom" type="date" class="form-control form-control-sm">
          </div>
          <div>
            <div class="filter-label mb-1">Date To</div>
            <input id="dateTo" type="date" class="form-control form-control-sm">
          </div>
          <div>
            <div class="filter-label mb-1">Confidence</div>
            <input id="confMin" type="text" class="form-control form-control-sm" placeholder="number">
          </div>
          <div>
            <div class="filter-label mb-1">Search URL</div>
            <input id="urlFilter" type="text" class="form-control form-control-sm" placeholder="Type part of URL">
          </div>
          <div class="text-end">
            <button id="downloadBtn" class="btn btn-primary btn-sm">Download CSV</button>
          </div>
        </div>

        <div class="table-responsive">
          <table id="logsTable" class="table table-hover align-middle">
            <colgroup>
              <col class="col-exported">
              <col class="col-url">
              <col class="col-label">
              <col class="col-confidence">
              <col class="col-source">
              <col class="col-author">
            </colgroup>
            <thead>
              <tr>
                <th>Exported</th>
                <th>URL</th>
                <th>Label</th>
                <th>Confidence</th>
                <th>Source</th>
                <th>Author</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Pagination controls: SAME STYLE AS AUTO PAGE -->
        <div id="paginationControls" class="d-flex justify-content-between align-items-center mt-2 small d-none">
          <div id="paginationInfo" class="text-muted"></div>
          <div>
            <button id="prevPage" class="btn btn-outline-secondary btn-sm">Previous</button>
            <button id="nextPage" class="btn btn-outline-secondary btn-sm">Next</button>
          </div>
        </div>

        <div id="emptyState" class="text-muted text-center d-none">No logs found.</div>
      </div>
    </div>
  </div>

  <!-- Raw text from the view -->
  <textarea id="rawLog" class="d-none">{{ log_content }}</textarea>

  <!-- Tiny inline script to pass Django data to external JS -->
  <script>
    window.selectedCourseName = "{{ course_name|escapejs }}";
  </script>

  <!-- Page logic -->
  <script src="{% static 'scraperSite/js/manual_scan_log.js' %}"></script>
{% endblock %}